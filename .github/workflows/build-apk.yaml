name: Build GraphBuilder APK

on: 
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

jobs:
  build-android:
    name: Build APK
    runs-on: ubuntu-latest

    container:
      image: ArtemSBulgakov/buildozer-action
      options: --user root  # важно для прав записи

    steps:
      # 1️⃣ Чекаем репозиторий
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2️⃣ (Опционально) обновляем pip и ставим Buildozer
      - name: Ensure Buildozer is installed
        run: |
          python -m pip install --upgrade pip
          pip install "buildozer==1.5.0" "cython==0.29.36"

      # 3️⃣ Сборка APK в корне проекта
      - name: Build APK
        run: |
          buildozer android debug

      # 4️⃣ Загрузка APK в артефакты
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: kivy-apk
          path: bin/*.apk
